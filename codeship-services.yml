builder:
  build:
    image: splunk/fluent-plugin-splunk-hec
    dockerfile_path: Dockerfile
  hostname: fluent-plugin-splunk-hec
  cached: false

unittests:
  build:
    image: splunk/fluent-plugin-splunk-hec
    dockerfile_path: Dockerfile
  volumes_from:
    - builder

deploysplunk:
  build:
    image: splunkimage
    dockerfile_path: Dockerfile.Splunk
  hostname: splunk
  environment:
  - SPLUNK_START_ARGS=--accept-license
  - SPLUNK_USER=root

integrationtests:
  build:
    image: Dockerfile.Fluentd
    dockerfile_path: Dockerfile.Fluentd
  link:
    - builder
    - deploysplunk